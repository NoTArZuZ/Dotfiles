#!/usr/bin/env bash

source ~/.config/qtile/vars
source ~/.config/qtile/curtheme

set -euo pipefail

# this thing gonna be MASSIVE
# for now qtile, dunst, helix, xresources (gtk and qt through home-manager) is supported

waltheming() {
wallust run ~/.cache/wallcache
qtile cmd-obj -o cmd -f reload_config
xrdb -merge ~/.Xresources
kill -s USR1 $(pidof st)
pkill dunst
}

gtktheming() {
  case $CURTHEME in
    "DoomOne")
      gtktheme="Qogir-Dark"
      icontheme="Qogir"
    ;;
    "Gruvbox")
      gtktheme="gruvbox-dark"
      icontheme="Papirus-Dark"
    ;;
    "Dracula")
      gtktheme="Dracula"
      icontheme="Dracula"
    ;;
    "CatppuccinMocha")
      gtktheme="Dracula"
      icontheme="Dracula"
    ;;
    "RosePine")
      gtktheme="Dracula"
      icontheme="Dracula"
    ;;
  esac
  case $choose2 in
    "DoomOne")
      choosegtktheme="Qogir-Dark"
      chooseicontheme="Qogir"
    ;;
    "Gruvbox")
      choosegtktheme="gruvbox-dark"
      chooseicontheme="Papirus-Dark"
    ;;
    "Dracula")
      choosegtktheme="Dracula"
      chooseicontheme="Dracula"
    ;;
    "CatppuccinMocha")
      choosegtktheme="Dracula"
      chooseicontheme="Dracula"
    ;;
    "RosePine")
      choosegtktheme="Dracula"
      chooseicontheme="Dracula"
    ;;
  esac
  sed -i "2s/$icontheme/$chooseicontheme/" $HOME/Dotfiles/.gtkrc-2.0
  sed -i "3s/$gtktheme/$choosegtktheme/" $HOME/Dotfiles/.gtkrc-2.0
  sed -i "4s/$icontheme/$chooseicontheme/" $HOME/Dotfiles/.config/gtk-3.0/settings.ini
  sed -i "5s/$gtktheme/$choosegtktheme/" $HOME/Dotfiles/.config/gtk-3.0/settings.ini
  sed -i "1s/$gtktheme/$choosegtktheme/" $HOME/Dotfiles/.config/xsettingsd/xsettingsd.conf
  sed -i "2s/$icontheme/$chooseicontheme/" $HOME/Dotfiles/.config/xsettingsd/xsettingsd.conf
}

while test $# -gt 0; do
  case "$1" in
    -w)
      if [ $CURTHEME == "Wal" ]; then
        waltheming
        exit 0
      else
        exit 0
      fi
    ;;
    *)
      printf "[-w] - wallust run\n"
      exit 1
    ;;
  esac
done

choose2=$(printf "$themes" | $menu "Choose:" -R -l $(printf "$themes\n" | wc -l))
if [ $choose2 == "Wal" ]; then
  sed -i "s/^colors = colors.*/colors = colors.$choose2/g" $HOME/Dotfiles/.config/qtile/config.py
  sed -i "s/$CURTHEME/$choose2/" $HOME/Dotfiles/.config/helix/config.toml
  sed -i "s/$CURTHEME/$choose2/" $HOME/Dotfiles/.config/qtile/curtheme
  waltheming
  notify-send "Theme Tool" "Changed Theme to Wallust"
else
  sed -i "s/^colors = colors.*/colors = colors.$choose2/g" $HOME/Dotfiles/.config/qtile/config.py
  sed -i "s/$CURTHEME/$choose2/" $HOME/Dotfiles/.config/helix/config.toml
  cp ~/Dotfiles/.config/qthemes/dunst-"$choose2" $HOME/Dotfiles/.config/dunst/dunstrc
  cp ~/Dotfiles/.config/qthemes/xres-"$choose2" $HOME/Dotfiles/.Xresources
  gtktheming
  sed -i "s/$CURTHEME/$choose2/" $HOME/Dotfiles/.config/qtile/curtheme
  qtile cmd-obj -o cmd -f reload_config
  xrdb -merge ~/.Xresources
  kill -s USR1 $(pidof st)
  pkill dunst
  sleep 1
  notify-send "Theme Tool" "Changed Theme to $choose2"
fi
